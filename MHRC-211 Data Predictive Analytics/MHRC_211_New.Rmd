---
title: "Analysis of 211 calls and some MHRC analysis"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    always_allow_html: true
  word_document:
    toc: true
  pdf_document:
    toc: true
    number_sections: true
    latex_engine: xelatex
    df_print: paged
    includes:
      in_header: header.tex
date: "2025-04-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

            Here we are combining 211 dataset from different provinces and analyzing call data and find insights. Here we are also checking on Mental health related calls and analyzing those data to find the details inferred from data.
            We are also looking into MHRC cleaned dataset generated by one of our teammates for analyzing and getting insights.
            
# Dataset Used

        For our analysis we used MHRC dataset and 211 calls dataset, mainly 211 calls related to mental or anxiety issues

# Data Cleaning

      - In our analysis we removed duplicate rows,rows which are blank.
      
      - For analysis we also convert some fields into numeric after removing unwanted charachters.
      
      - In some places where we need to do some arithmetic operations, we convert Na to 0.
      
      - check for uniqueness of id columns
      
      - Before analysis I like to do basic cleaning
      
      - After that based on the columns which we are analyzing,i did necessary modification
      
      - When we tried to convert a charachter field where majority of values are numbers, but we can't directly  converted into numeric, as that contains charachter values in some fields or values.
      
# Links to Datasets

[211 Calldetails](https://ab-data.dataforgood.ca/apps/files/files/1533?dir=/2025%20-%20Mental%20Health%20Converge%20Teams%20Folder/DataHealers/Data%20Healers)

[MHRC Cleaned Dataset](https://ab-data.dataforgood.ca/apps/files/files/101032?dir=/2025%20-%20Mental%20Health%20Converge%20Teams%20Folder/DataHealers/DataHealers%20TeamWork)

# Additional Analysis

 - If we have more time we will try to analyze how season or climate effect mental disorders.
 - We had created a dashboard, there we could see like more 211 calls are during winter season. 
 - We like to study more on that and also like to know on the effect of social media and news on Mental disorders.
 - We also likes to analyze on community support and effect on Mental or anxiety disorders.
 
# Data Gaps or Quality Issues Addressed

- We removed duplicate rows, empty rows and also address datatype change based on the column we worked on.

- We also tried to organize Age data, which is not properly ordered in source data.

- We also organize call type from 211 data set, as call type values are not properly addressed.

- For 211 data set we couldn't identify data gaps.

- But for MHRC data is already cleaned by one of our team mates who use python, so not sure on data gap.

# Suggessions to Organization

- MHRC dataset is so huge, so that is not properly cleaned.It will be better if we could clean more.

- Currently we mainly do analyze MHRC by percentage, as data is so huge.
- If possible organizing that data in more meaningful way, we could get grater insights.
- We did our Analysis with limited time and resources. 
- More vast analysis of MHRC data is recommented.

       
# Application

```{r}
# Load Required Libraries
#install.packages("dplyr")
#install.packages("ggplot2")
#install.packages("jsonlite")
#install.packages("treemapify")
#install.packages("viridis")
# Install required packages if not already installed
#if (!require("ggrepel")) install.packages("ggrepel")
# Load treemapify if not already
#if (!require("treemapify")) install.packages("treemapify")
# Load required libraries
#install.packages("viridis")





```

## Loading libraries

```{r warning=FALSE}
# Load libraries
library(tidyverse)
library(ggplot2)
library(ggVennDiagram)
library(RColorBrewer)
library(scales)
library(ggrepel)
library(dplyr)
library(treemapify)
library(stringr)
library(wordcloud) #word cloud Needs
library(tm)
library(forcats)  # for fct_reorder
library(viridis)
library(tidyr)
library(lubridate)
library(readxl)
library(jsonlite)
```

## Setting Working directory

```{r warning=FALSE}
setwd("C:\\Users\\athir\\OneDrive\\Documents\\Athira Doc\\Data Science\\New folder")

getwd()




```

## Combining 211 call details from 8 provinces into 4 objects and clean that

```{r}

# --------------------
# Combine 8 provincial CallReports datasets into one
# --------------------
BC_CallReports <- read.csv("BC_211_CallReports.csv", fileEncoding = "latin1")
Calgary_CallReports <- read.csv("Calgary_211_CallReports.csv", fileEncoding = "latin1")
Central_CallReports <- read.csv("Central_211_CallReports.csv", fileEncoding = "latin1")
Edmonton_CallReports <- read.csv("Edmonton_211_CallReports.csv", fileEncoding = "latin1")
NovaScotia_CallReports <- read.csv("NovaScotia_211_CallReports.csv", fileEncoding = "latin1")
Ontario_CallReports <- read.csv("Ontario_211_CallReports.csv", fileEncoding = "latin1")
PEI_CallReports <- read.csv("PEI_211_CallReports.csv", fileEncoding = "latin1")
Saskatchewan_CallReports <- read.csv("Saskatchewan_211_CallReports.csv", fileEncoding = "latin1")

# Get common columns across all files
common_columns <- Reduce(intersect, list(
  colnames(BC_CallReports), colnames(Calgary_CallReports), colnames(Central_CallReports),
  colnames(Edmonton_CallReports), colnames(NovaScotia_CallReports), colnames(Ontario_CallReports),
  colnames(PEI_CallReports), colnames(Saskatchewan_CallReports)
))

# Bind all into one unified dataset
CallReports <- rbind(
  subset(BC_CallReports, select = common_columns),
  subset(Calgary_CallReports, select = common_columns),
  subset(Central_CallReports, select = common_columns),
  subset(Edmonton_CallReports, select = common_columns),
  subset(NovaScotia_CallReports, select = common_columns),
  subset(Ontario_CallReports, select = common_columns),
  subset(PEI_CallReports, select = common_columns),
  subset(Saskatchewan_CallReports, select = common_columns)
)

# --------------------
# Clean CallReports data
# --------------------
#View(CallReports)                                # Preview dataset
colSums(is.na(CallReports))                      # Count missing values
colSums(CallReports == "")                       # Count empty strings
length(unique(CallReports$CallReportNum))        # Check uniqueness of ID column
CallReports_clean <- CallReports[!duplicated(CallReports), ]  # Remove duplicates
#View(CallReports_clean)


# --------------------
# Combine 8 provincial Needs datasets into one
# --------------------
BC_Needs <- read.csv("BC_211_Needs.csv", fileEncoding = "latin1")
Calgary_Needs <- read.csv("Calgary_211_Needs.csv", fileEncoding = "latin1")
Central_Needs <- read.csv("Central_211_Needs.csv", fileEncoding = "latin1")
Edmonton_Needs <- read.csv("Edmonton_211_Needs.csv", fileEncoding = "latin1")
NovaScotia_Needs <- read.csv("NovaScotia_211_Needs.csv", fileEncoding = "latin1")
Ontario_Needs <- read.csv("Ontario_211_Needs.csv", fileEncoding = "latin1")
PEI_Needs <- read.csv("PEI_211_Needs.csv", fileEncoding = "latin1")
Saskatchewan_Needs <- read.csv("Saskatchewan_211_Needs.csv", fileEncoding = "latin1")

# Get common columns across all files
common_columns1 <- Reduce(intersect, list(
  colnames(BC_Needs), colnames(Calgary_Needs), colnames(Central_Needs),
  colnames(Edmonton_Needs), colnames(NovaScotia_Needs), colnames(Ontario_Needs),
  colnames(PEI_Needs), colnames(Saskatchewan_Needs)
))

# Bind into one unified dataset
Needs <- rbind(
  subset(BC_Needs, select = common_columns1),
  subset(Calgary_Needs, select = common_columns1),
  subset(Central_Needs, select = common_columns1),
  subset(Edmonton_Needs, select = common_columns1),
  subset(NovaScotia_Needs, select = common_columns1),
  subset(Ontario_Needs, select = common_columns1),
  subset(PEI_Needs, select = common_columns1),
  subset(Saskatchewan_Needs, select = common_columns1)
)

# Clean Needs data
#View(Needs)
colSums(Needs == "")
colSums(is.na(Needs))
Needs_clean <- Needs[!duplicated(Needs), ]
#View(Needs_clean)


# --------------------
# Combine 8 provincial Referral datasets into one
# --------------------
BC_Referrals <- read.csv("BC_211_Referrals.csv", fileEncoding = "latin1")
Calgary_Referrals <- read.csv("Calgary_211_Referrals.csv", fileEncoding = "latin1")
Central_Referrals <- read.csv("Central_211_Referrals.csv", fileEncoding = "latin1")
Edmonton_Referrals <- read.csv("Edmonton_211_Referrals.csv", fileEncoding = "latin1")
NovaScotia_Referrals <- read.csv("NovaScotia_211_Referrals.csv", fileEncoding = "latin1")
Ontario_Referrals <- read.csv("Ontario_211_Referrals.csv", fileEncoding = "latin1")
PEI_Referrals <- read.csv("PEI_211_Referrals.csv", fileEncoding = "latin1")
Saskatchewan_Referrals <- read.csv("Saskatchewan_211_Referrals.csv", fileEncoding = "latin1")

# Get common columns across all files
common_columns2 <- Reduce(intersect, list(
  colnames(BC_Referrals), colnames(Calgary_Referrals), colnames(Central_Referrals),
  colnames(Edmonton_Referrals), colnames(NovaScotia_Referrals), colnames(Ontario_Referrals),
  colnames(PEI_Referrals), colnames(Saskatchewan_Referrals)
))

# Bind into one dataset
Refferals <- rbind(
  subset(BC_Referrals, select = common_columns2),
  subset(Calgary_Referrals, select = common_columns2),
  subset(Central_Referrals, select = common_columns2),
  subset(Edmonton_Referrals, select = common_columns2),
  subset(NovaScotia_Referrals, select = common_columns2),
  subset(Ontario_Referrals, select = common_columns2),
  subset(PEI_Referrals, select = common_columns2),
  subset(Saskatchewan_Referrals, select = common_columns2)
)

# Clean Referrals data
#View(Refferals)
colSums(is.na(Refferals))
colSums(Refferals == "")
Refferals_clean <- Refferals[!duplicated(Refferals), ]
#View(Refferals_clean)
```

## Created a vector of age group,joined and assighned with call report and plot that for finding insights

```{r warning=FALSE}



# Define a named vector mapping detailed age values to new age groups
age_map <- list(
  "0-12" = c("0-12","0-4","5-9","12","0","1","11","6","9","3","5","8","10","2","4","7","0-6"),
  "13-18" = c("13-15","16","17","13","15","14","13-18"),
  "15-19" = c("15-19","16-17"),
  "18-24" = c("18-24","18"),
  "19-54" = c("35-54","19-54","35-44","25-34","45-54","19-34","40-49","30-39","25-29",
              "20-24","54","40","33","38","28","39","30","29","50","32","42","35","36",
              "22","21","34","31","23","26","44","37","41","20","53","27","51","43",
              "25","45","49","19","52","46","47","48","24","12-24"),
  "55-64" = c("55","55-64","56","61","67"),
  "60-69" = c("60-69","65","68"),
  "65+" = c("59","65+","58","60","64","63","62","67","66","69"),
  "70-79" = c("70","70-79","74","75","71","72","76","77","79","73","78"),
  "80+" = c("80+","80","81","90","85","86","83","84","88","82","92","87","89",
            "93","94","95","91","96","100","98","103","99"),
  "45-65" = c("45-65"),
  "25-65" = c("25-65"),
  "25-64" = c("25-64"),
  "Senior" = c("Senior"),
  "Adult" = c("Adult")
)

# Convert mapping to a lookup dataframe
age_lookup <- tibble(
  original = unlist(age_map),
  grouped_age = rep(names(age_map), times = sapply(age_map, length))
)

# Join and assign new age group
CallReports_cleaned <- CallReports %>%
  left_join(age_lookup, by = c("Age" = "original")) %>%
  mutate(grouped_age = if_else(is.na(grouped_age), "Unknown", grouped_age))  # Optional fallback

# plot


CallReports_cleaned %>%
  count(grouped_age) %>%
  ggplot(aes(x = reorder(grouped_age, -n), y = n, fill = grouped_age)) +
  geom_col() +
  theme_minimal() +
  labs(title = "Call Count by Age Group", x = "Grouped Age", y = "Number of Calls") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")

```

## Joining callreports dataset with needs dataset

```{r}
# --------------------
# Initial join and integrity check between CallReports and Needs
# --------------------
joined_df_space <- CallReports %>% 
  left_join(Needs, by = c("CallReportNum" = "ReportNeedNum")) %>% 
  mutate(checking_val1 = ifelse(CallType == "", Needs$NeedMet, 0))
View(joined_df_space)

```

## Plot age group and its count of people in that age group

```{r}

CallReports_clean <- CallReports %>%
  mutate(
    # Step 1: Create temporary numeric age (or pass "Adult"/"Senior" through)
    temp_age = case_when(
      grepl("(?i)^senior$", Age) ~ NA_real_,
      grepl("(?i)^adult$", Age) ~ NA_real_,
      grepl("^\\d+$", Age) ~ as.numeric(Age),
      grepl("^\\d+-\\d+$", Age) ~ as.numeric(sub("-.*", "", Age)),
      TRUE ~ NA_real_
    ),
    # Step 2: Clean Age Group
    Age_group = case_when(
      grepl("(?i)^senior$", Age) ~ "Senior",
      grepl("(?i)^adult$", Age) ~ "Adult",
      !is.na(temp_age) & temp_age <= 17 ~ "0-17",
      !is.na(temp_age) & temp_age >= 18 & temp_age <= 24 ~ "18-24",
      !is.na(temp_age) & temp_age >= 25 & temp_age <= 34 ~ "25-34",
      !is.na(temp_age) & temp_age >= 35 & temp_age <= 44 ~ "35-44",
      !is.na(temp_age) & temp_age >= 45 & temp_age <= 54 ~ "45-54",
      !is.na(temp_age) & temp_age >= 55 & temp_age <= 64 ~ "55-64",
      !is.na(temp_age) & temp_age >= 65 & temp_age <= 79 ~ "65-79",
      !is.na(temp_age) & temp_age >= 80 ~ "80+",
      TRUE ~ NA_character_
    )
  ) %>%
  filter(!is.na(Age_group)) %>%
  select(-temp_age)  # Clean up temporary column

  
  

CallReports_clean %>%
  count(Age_group) %>%
  ggplot(aes(x = reorder(Age_group, -n), y = n, fill = Age_group)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  scale_fill_viridis_d() +
  labs(
    title = "Call Distribution by Age Group",
    x = "Age Group",
    y = "Number of Calls"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold", hjust = 0.5)
  )
```


## Analyzing data by using different plots

```{r}

#Pie chart of total number of callers 
# Prepare data
Sorted_val2 <- tibble::tibble(
  Gender = c("Female", "Male", "", "Non-binary/non-conforming", 
        8     "Trans-Female", "Transgender", "Trans-male", "2 Spirit"),
  count = c(716345, 406108, 255028, 942, 761, 673, 160, 42)
)

Sorted_val2 <- Sorted_val2 %>%
  mutate(Gender = ifelse(Gender == "", "Unspecified", Gender)) %>%
  mutate(percentage = count / sum(count),
         label = paste0(Gender, ": ", percent(percentage, accuracy = 0.1)),
         ypos = cumsum(count) - 0.5 * count)



# Prepare data
Sorted_val2 <- Sorted_val2 %>%
  mutate(
    pct = count / sum(count) * 100,
    label = paste0(Gender, "\n", round(pct, 1), "%"),
    legend_label = paste0(Gender, " (", count, ", ", round(pct, 1), "%)"),
    ypos = cumsum(count) - 0.5 * count
  )
Sorted_val2 <- Sorted_val2 %>%
  arrange(desc(legend_label)) %>%
  mutate(
    pct = count / sum(count) * 100,
    ypos = cumsum(count) - 0.5 * count
  )

ggplot(Sorted_val2, aes(x = "", y = count, fill = legend_label)) +
  geom_col(width = 1, color = "white") +
  coord_polar(theta = "y") +
  geom_text(
    aes(y = ypos, label = paste0(round(pct, 1), "%")),
    color = "black",
    size = 4
  ) +
  theme_void() +
  labs(title = "Distribution of Callers by Gender", fill = "Gender (Count, %)") +
  theme(plot.title = element_text(hjust = 0.5, size = 16)) +
  scale_fill_brewer(palette = "Set3")

```
```{r warning=FALSE}
library(ggplot2)
library(ggrepel)
library(dplyr)
library(scales)

Sorted_val2 <- tibble::tibble(
  Gender = c("Female", "Male", "", "Non-binary/non-conforming", 
             "Trans-Female", "Transgender", "Trans-male", "2 Spirit"),
  count = c(716345, 406108, 255028, 942, 761, 673, 160, 42)
)

Sorted_val2 <- Sorted_val2 %>%
  mutate(Gender = ifelse(Gender == "", "Unspecified", Gender)) %>%
  arrange(desc(Gender)) %>%
  mutate(
    pct = count / sum(count) * 100,
    label = paste0(Gender, ": ", round(pct, 1), "%"),
    ypos = cumsum(count) - 0.5 * count
  )

# Donut chart with label repel
ggplot(Sorted_val2, aes(x = 2, y = count, fill = Gender)) +
  geom_col(width = 1, color = "white") +
  coord_polar(theta = "y") +
  xlim(0.5, 2.5) +
  geom_label_repel(
    aes(label = label, y = ypos),
    size = 4,
    nudge_x = 1.2,
    show.legend = FALSE,
    segment.color = "grey50"
  ) +
  theme_void() +
  labs(title = "Distribution of Callers by Gender", fill = "Gender (Count, %)") +
  theme(plot.title = element_text(hjust = 0.5, size = 16)) +
  scale_fill_brewer(palette = "Set3")



```

# Plotting bar chart for first 10 call types

```{r}

# bar plot fo top 10 call types 
CallReports %>%
  filter(CallType != "") %>%
  count(CallType, sort = TRUE) %>%
  top_n(10) %>%
  ggplot(aes(x = reorder(CallType, n), y = n, fill = CallType)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Top 10 Call Types", x = "Call Type", y = "Count") +
  scale_fill_brewer(palette = "Paired") +
  theme_minimal()

```

# Plotting the graph based on first 10 needs


```{r}

# Treemap using AIRSNeedCategory
Needs %>%
  filter(AIRSNeedCategory != "") %>%
  count(AIRSNeedCategory, sort = TRUE) %>%
  top_n(20) %>%
  ggplot(aes(area = n, fill = AIRSNeedCategory, label = AIRSNeedCategory)) +
  geom_treemap() +
  geom_treemap_text(colour = "white", place = "centre", grow = TRUE, reflow = TRUE) +
  labs(title = "Top 20 Needs Reported by AIRS Category") +
  theme(legend.position = "none",
        plot.title = element_text(face = "bold", hjust = 0.5))

```

# Timeseries plot for calls per month

```{r}

#timeseries : calls per month 
CallReports %>%
  mutate(Month = lubridate::floor_date(as.Date(CallDateAndTimeStart, format = "%Y-%m-%d"), "month")) %>%
  count(Month) %>%
  ggplot(aes(x = Month, y = n)) +
  geom_line(color = "#1f78b4") +
  labs(title = "Monthly Call Trends", x = "Month", y = "Number of Calls") +
  theme_minimal()
```

# Tried to remove multiple call transfers into single entry and plot bar chart

```{r}

Service_call_count<-CallReports %>% group_by(CallType) %>% summarise(count=n())
View(Service_call_count)
transfer_sum <- sum(Service_call_count$count[grepl("Transfer", Service_call_count$CallType, ignore.case = TRUE)])
Service_call_count<- Service_call_count %>% mutate(call_details=ifelse(grepl("Transfer",Service_call_count$CallType,ignore.case = TRUE) == TRUE,transfer_sum,count))
#print(Service_call_count)
new_row<-filter(Service_call_count,grepl("^Cold Transfer$",Service_call_count$CallType)==TRUE)
pattern="Cold transfer provided$"
Service_call_count<-filter(Service_call_count,grepl(pattern,Service_call_count$CallType)!= TRUE & grepl("Cold Transfer$",Service_call_count$CallType)!=TRUE)
Service_call_count<-rbind(Service_call_count,new_row)

sorted_value<-arrange(Service_call_count,desc(count))
#print(sorted_value[1,])
#which calls have more count based on Age, call type and gender.
Service_call_ByGender_Age_calltype<-CallReports %>% group_by(CallType,Gender,Age) %>% summarise(count=n())
#View(Service_call_ByGender_Age_calltype)
Sorted_val1<-arrange(Service_call_ByGender_Age_calltype,desc(count))



Sorted_val1 %>%
  filter(count > 0) %>%
  mutate(AgeGroup = case_when(
    Age %in% c("18-24", "25-34", "19-24") ~ "18-34",
    Age %in% c("35-44", "45-54", "55-64") ~ "35-64",
    Age %in% c("65+", "60-69") ~ "65+",
    TRUE ~ "Other"
  )) %>%
  group_by(Gender, AgeGroup) %>%
  summarise(count = sum(count)) %>%
  ggplot(aes(x = Gender, y = count, fill = AgeGroup)) +
  geom_bar(stat = "identity") +
  labs(title = "Bar Plot by Gender and Age Group",
       x = "Gender", y = "Count") +
  facet_wrap(~ AgeGroup) +  # Faceting by AgeGroup
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

Sorted_val1 %>%
  filter(count > 0) %>%
  mutate(AgeGroup = case_when(
    Age %in% c("18-24", "25-34", "19-24") ~ "18-34",
    Age %in% c("35-44", "45-54", "55-64") ~ "35-64",
    Age %in% c("65+", "60-69") ~ "65+",
    TRUE ~ "Other"
  )) %>%
  group_by(Gender, AgeGroup) %>%
  summarise(count = sum(count)) %>%
  ggplot(aes(x = AgeGroup, y = count, fill = Gender)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(title = "Stacked Bar Plot: Calls by Gender and Age Group",
       x = "Age Group", y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))



```

# plotting a map to check how much of needs are met

```{r}
#needsmet proportion doughnet  chart 
Needs %>%
  count(NeedMet) %>%
  mutate(pct = n / sum(n), label = paste0(NeedMet, ": ", round(pct*100, 1), "%")) %>%
  ggplot(aes(x = 2, y = pct, fill = NeedMet)) +
  geom_col(width = 1, color = "white") +
  coord_polar("y") +
  xlim(0.5, 2.5) +
  geom_text(aes(label = label), position = position_stack(vjust = 0.5)) +
  theme_void() +
  labs(title = "Need Met Status Breakdown") +
  scale_fill_brewer(palette = "Set2")

```



```{r warning=FALSE}

word_freq <- table(Needs$AIRSNeedCategory)
wordcloud(names(word_freq), freq = word_freq, max.words = 300, colors = brewer.pal(12, "Paired"), scale = c(4, 0.5),         
  random.order = FALSE,      rot.per = 0.25             )



```



```{r}

#Density Plot: Call Durations

CallReports %>%
  filter(CallLength > 0) %>%
  ggplot(aes(x = CallLength)) +
  geom_density(fill = "skyblue", alpha = 0.5) +
  labs(title = "Distribution of Call Durations") +
  theme_minimal()

```


```{r}
#Mosaic Plot: Age vs Gender

filtered_data <- CallReports_clean %>%
  filter(!is.na(Gender), Gender != " ", !is.na(Age_group), Age_group != "")

# Order Age_group by frequency to improve readability
age_gender_counts <- filtered_data %>%
  count(Age_group, Gender)

ggplot(age_gender_counts, aes(x = fct_reorder(Age_group, n), y = n, fill = Gender)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Distribution of Gender Across Age Groups",
    x = "Age Group",
    y = "Number of Calls",
    fill = "Gender"
  ) +
  theme_minimal(base_size = 16) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    axis.text.x = element_text(angle = 60, hjust = 1, size = 12),
    axis.text.y = element_text(size = 12)
  ) +
  scale_fill_brewer(palette = "Set2")


```


```{r warning=FALSE}
#call duration by province 
CallReports %>%
  filter(StateProvince != "", CallLength > 0) %>%
  ggplot(aes(x = StateProvince, y = CallLength, fill = StateProvince)) +
  geom_boxplot() +
  labs(title = "Call Length Distribution by Province",
       x = "Province",
       y = "Call Length (in seconds/mins)") +
  theme_minimal(base_size = 14) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_brewer(palette = "Dark2")
```


```{r}



# --- Clean and categorize service call types ---
category_map <- c(
  "Cold Transfer" = c("Cold transfer", "Cold transfer provided"),
  "Crisis" = c("Telephone crisis intervention", "Telephone crisis intervention; Cold Transfer"),
  "Referral" = c("Referral", "Referral; Cold Transfer", "Referral; Telephone crisis intervention", "Referral; Cold transfer provided"),
  "Information/Education" = c("Information/Education", "Information/Education; Cold Transfer", "Information/Education; Referral", "Information/Education; Telephone crisis intervention")
)

map_to_broad_category <- function(call_type) {
  for (broad_category in names(category_map)) {
    if (any(sapply(category_map[[broad_category]], function(pattern) str_detect(call_type, fixed(pattern))))) {
      return(broad_category)
    }
  }
  return("Other")
}

# Clean the service call type dataset
Service_call_count_clean <- Service_call_count %>%
  mutate(
    Final_Service_Type = str_extract(CallType, "(?<=/)[^/]+$"),
    Broad_Service_Type = sapply(CallType, map_to_broad_category)
  )

# Summary of broad categories
Service_call_count_summary <- Service_call_count_clean %>%
  count(Broad_Service_Type) %>%
  arrange(desc(n))

#print(Service_call_count_summary)

# --- Top Needs by Gender ---
CallReports_clean$Gender[CallReports_clean$Gender==""] <- NA
CallReports_clean<- CallReports_clean %>% filter(!is.na(Gender))
Needs_clean$AIRSNeedCategory[Needs_clean$AIRSNeedCategory==""] <- NA
Needs_clean<-Needs_clean %>% filter(!is.na(AIRSNeedCategory))
#Needs
Needs_clean %>%
  left_join(CallReports_clean, by = c("ReportNeedNum" = "CallReportNum")) %>%
  #filter(Gender != "", AIRSNeedCategory != "") %>%
  count(Gender, AIRSNeedCategory) %>%
  group_by(Gender) %>%
  slice_max(n, n = 3) %>%
  ggplot(aes(x = reorder(AIRSNeedCategory, n), y = n, fill = Gender)) +
  geom_col(position = "dodge") +
  coord_flip() +
  labs(title = "Top Needs by Gender", x = "Need Category", y = "Number of Calls") +
  theme_minimal()
```


```{r}
# --- Call Types Over Time (Stacked Area Chart for Top 6 Types) ---
# Ensure date is in proper format
CallReports <- CallReports %>%
  mutate(CallDateAndTimeStart = as.Date(CallDateAndTimeStart))

top_call_types <- CallReports %>%
  count(CallType, sort = TRUE) %>%
  slice_head(n = 6) %>%
  pull(CallType)

CallReports %>%
  filter(CallType %in% top_call_types) %>%
  mutate(Month = floor_date(CallDateAndTimeStart, "month")) %>%
  count(Month, CallType) %>%
  ggplot(aes(x = Month, y = n, fill = CallType)) +
  geom_area() +
  labs(title = "Top Call Types Over Time", x = "Month", y = "Number of Calls") +
  theme_minimal()

```


```{r}
ggplot(Service_call_count_summary, aes(x = reorder(Broad_Service_Type, n), y = n)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(title = "Distribution of Service Call Types", x = "Call Type", y = "Count") +
  theme_minimal()


CallReports %>%
  mutate(Month = floor_date(as.Date(CallDateAndTimeStart), "month")) %>%
  filter(CallType %in% top_call_types) %>%
  count(Month, CallType) %>%
  ggplot(aes(x = Month, y = n, color = CallType)) +
  geom_line() +
  labs(title = "Monthly Trends in Top Call Types") +
  theme_minimal()
CallReports %>%
  filter(CallType != "") %>%
  count(StateProvince, CallType) %>%
  group_by(StateProvince) %>%
  slice_max(n, n = 3) %>%
  ggplot(aes(x = reorder(StateProvince, -n), y = n, fill = CallType)) +
  geom_col(position = "dodge") +
  labs(title = "Top Call Types by Province") +
  theme_minimal()


CallReports %>%
  filter(Gender != "", Age != "", CallType != "") %>%
  count(Gender, Age, CallType) %>%
  ggplot(aes(area = n, fill = Gender, label = CallType, subgroup = Age)) +
  geom_treemap() +
  geom_treemap_subgroup_border() +
  geom_treemap_text(colour = "white", place = "centre", grow = TRUE) +
  labs(title = "Treemap of Call Types by Gender and Age") +
  theme_minimal()






```



```{r}

#Duration by Gender 
CallReports %>%
  filter(Gender != "", CallLength > 0) %>%
  ggplot(aes(x = Gender, y = CallLength, fill = Gender)) +
  geom_violin(trim = FALSE) +
  labs(title = "Distribution of Call Length by Gender",
       x = "Gender",
       y = "Call Length (in seconds/mins)") +
  theme_minimal(base_size = 14) +
  scale_fill_brewer(palette = "Paired")

```


```{r}

#Histogram :Call Length Distribution 
CallReports %>%
  filter(CallLength > 0) %>%
  ggplot(aes(x = CallLength)) +
  geom_histogram(binwidth = 60, fill = "#69b3a2", color = "white") +
  labs(title = "Distribution of Call Lengths",
       x = "Call Length (in seconds/mins)",
       y = "Number of Calls") +
  theme_minimal(base_size = 14)

```

```{r}



# ─── Data Aggregation ──────────────────────────────────────────────────────────

# 1. Total Calls by Age Group
age_call_counts <- CallReports %>%
  group_by(Age) %>%
  summarise(total_calls = n()) %>%
  arrange(desc(total_calls))

# 2. Total Calls by Call Type
call_type_counts <- CallReports %>%
  group_by(CallType) %>%
  summarise(total_calls = n()) %>%
  arrange(desc(total_calls))

# 3. Call Counts by Gender, Age, and Call Type
call_counts_by_demo <- CallReports %>%
  group_by(CallType, Gender, Age) %>%
  summarise(total_calls = n(), .groups = "drop")

# 4. Count of Needs by Level 1 Name (Mental Health Focused)
level1_need_counts <- Needs_clean %>%
  group_by(Level1Name) %>%
  summarise(total_needs = n()) %>%
  arrange(desc(total_needs))

# 5. Subset Mental Health-Related Needs
mental_health_needs <- Needs_clean %>%
  filter(Level1Name %in% c("Criminal Justice and Legal Services",
                           "Mental Health and Substance Use Disorder Services",
                           "Target Populations") |
           Level2Name == "Mutual Support")

mental_health_summary <- mental_health_needs %>%
  count(Level1Name)

```







```{r}

# 4. Treemap: Needs by AIRS Level 1 Category
ggplot(level1_need_counts, aes(area = total_needs, fill = Level1Name, label = Level1Name)) +
  geom_treemap() +
  geom_treemap_text(colour = "white", place = "centre", grow = TRUE) +
  labs(title = "Top Needs by Level 1 AIRS Category") +
  theme(legend.position = "none")

# 5. Pie Chart: Mental Health-Related Needs
ggplot(mental_health_summary, aes(x = "", y = n, fill = Level1Name)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  labs(title = "Mental Health Needs by Category",
       fill = "Level 1 Category") +
  theme_void()

```

```{r}




# --- Load & Inspect CallReports Data ---
# Age distribution
Age_range_Person <- CallReports_clean %>%
  group_by(Age) %>%
  summarise(Count = n()) %>%
  arrange(desc(Count))
#View(Age_range_Person)

```


```{r warning=FALSE}

# Most frequent call types
Service_call_count <- CallReports_clean %>%
  group_by(CallType) %>%
  summarise(Count = n()) %>%
  arrange(desc(Count))
#View(Service_call_count)
#print(Service_call_count[1, ])

# Count by CallType + Gender + Age
Service_call_ByGender_Age_calltype <- CallReports_clean %>%
  group_by(CallType, Gender, Age) %>%
  summarise(Count = n(), .groups = "drop") %>%
  arrange(desc(Count))
#View(Service_call_ByGender_Age_calltype)

# --- Load MHRC Dataset from JSON ---
lines1 <- readLines("nominal_df.json")
json_text <- paste0("[", paste(lines1, collapse = ","), "]")
MHRC_dataset <- fromJSON(json_text)
#View(MHRC_dataset)

# --- Analyze Needs Data ---
# Count needs by Level 1
Calls_related_Mentalissues <- Needs_clean %>%
  group_by(Level1Name) %>%
  summarise(Count_Level1 = n())
#print(Calls_related_Mentalissues)

# Filter for relevant mental health-related needs
Mental_health_data_211 <- Needs_clean %>%
  filter(Level1Name %in% c(
    "Criminal Justice and Legal Services",
    "Mental Health and Substance Use Disorder Services",
    "Target Populations"
  ) | Level2Name == "Mutual Support")

# Select relevant columns only
Mental_health_211 <- Mental_health_data_211 %>%
  select(-Level4Name, -Level5Name, -ParentResourceNum, -ParentAgencyName)
summary(Mental_health_211)

# --- Merge 211 and Call Report Data ---
# Ensure no duplicated columns before joining
intersect(names(CallReports_clean), names(Mental_health_211))

# Join on CallReportNum
Combined_CallReport_mentalhealth <- inner_join(
  CallReports_clean,
  Mental_health_211,
  by = "CallReportNum"
)

# Remove any duplicated columns (if needed)
Combined_CallReport_mentalhealth <- Combined_CallReport_mentalhealth %>%
  select(!ends_with(".y"))
#View(Combined_CallReport_mentalhealth)

```


```{r}
# --- Create Age Groups and Summarize ---

Age_range_Person <- CallReports %>%
  filter(!is.na(Age), Age != "") %>%
  mutate(
    Age = as.numeric(Age),  # Ensure Age is numeric
    Age_group = case_when(
      Age < 18 ~ "Under 18",
      Age >= 18 & Age <= 24 ~ "18-24",
      Age >= 25 & Age <= 34 ~ "25-34",
      Age >= 35 & Age <= 44 ~ "35-44",
      Age >= 45 & Age <= 54 ~ "45-54",
      Age >= 55 & Age <= 64 ~ "55-64",
      Age >= 65 ~ "65+",
      TRUE ~ "Unknown"
    )
  ) %>%
  count(Age_group, name = "Count")

# --- Plot Age Range Bar Chart ---

ggplot(Age_range_Person, aes(x = reorder(Age_group, -Count), y = Count, fill = Age_group)) +
  geom_col() +
  labs(title = "Call Counts by Age Group", x = "Age Group", y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```




```{r}
# Treemap of Top Needs
Needs_clean %>%
  count(AIRSNeedCategory) %>%
  top_n(20) %>%
  ggplot(aes(area = n, fill = AIRSNeedCategory, label = AIRSNeedCategory)) +
  geom_treemap() +
  geom_treemap_text(colour = "white", place = "centre", grow = TRUE) +
  labs(title = "Top 20 Need Categories (AIRS)") +
  theme(legend.position = "none")

```


```{r}

# Combined Call Report Summary (Mental Health)
ggplot(Combined_CallReport_mentalhealth, aes(x = StateProvince, fill = Level1Name)) +
  geom_bar(position = "dodge") +
  labs(title = "Mental Health-related Calls by Province", x = "Province", y = "Call Count") +
  theme_minimal() +
  scale_fill_viridis(discrete = TRUE)

```

```{r}

#getting data from 211 dataset related to Mental health and support related
Mental_health_data_211<- Needs_clean %>% filter(Needs_clean$Level1Name %in% c("Criminal Justice and Legal Services"
                                                                              ,"Mental Health and Substance Use Disorder Services","Target Populations") | (Needs_clean$Level2Name=="Mutual Support"))
#print(Mental_health_data_211)

#Get the needed column
Mental_health_211<-select(Mental_health_data_211,-Level4Name,-Level5Name,-ParentResourceNum,-ParentAgencyName)
#print(Mental_health_211)

summary(Mental_health_211)

#joining CallReport_clean and Mental_health_211(so can work on provinces, dates and related mental health)
Combined_CallReport_mentalhealth<-inner_join(CallReports_clean,Mental_health_211,by="CallReportNum")
#View(Combined_CallReport_mentalhealth)


#generating a new column year and month from datetime column based on call start time
sum(is.na(Combined_CallReport_mentalhealth$CallDateAndTimeStart))
library(lubridate)
Combined_CallReport_mentalhealth$CallDateAndTimeStart <- as.POSIXct(Combined_CallReport_mentalhealth$CallDateAndTimeStart,tz="UTC")
Combined_CallReport_mentalhealth <- Combined_CallReport_mentalhealth %>% mutate(Year = format(Combined_CallReport_mentalhealth$CallDateAndTimeStart,"%Y"),
)
#print(Combined_CallReport_mentalhealth$Year)
Combined_CallReport_mentalhealth<-Combined_CallReport_mentalhealth %>% mutate(Month_name = format(Combined_CallReport_mentalhealth$CallDateAndTimeStart, "%b"))
#print(Combined_CallReport_mentalhealth$Month_name)


# Created 2 daatset from 211 based on call received,Province,year and also MHRC poll date,month and province[ Can plot and tried to compare]
#print("211_dataset")
Combined_CallReport_mentalhealth %>% group_by(StateProvince,Year,Month_name) %>% summarise(count=n())
#print("MHRC Dataset")
MHRC_dataset %>% group_by(PROV,WAVE) %>% summarise(count=n())

# generated a dataset with needs not met and summarise the reason
Needs_not_met <- Combined_CallReport_mentalhealth %>% filter(NeedMet == "False") 
#print(Needs_not_met)
Needs_not_met_summarise_reason <- Needs_not_met %>% group_by(ReasonUnmet) %>% summarise(count=n())
#print(Needs_not_met_summarise_reason)
# summarize based on Year[ Trend showing 2022 most unmet needs happens]
Needs_not_met_summarise_reason_Year <- Needs_not_met %>% group_by(Year) %>% summarise(count=n())
#print(Needs_not_met_summarise_reason_Year)

#for 2022 reason for unmet needs is higher for Caller refused the refferal
filter(Needs_not_met,Needs_not_met$Year == "2022") %>% group_by(ReasonUnmet) %>% summarise(count=n())

```


```{r}

# --- 1. Mental Health Calls by Province, Year & Month ---
mh_trend <- Combined_CallReport_mentalhealth %>%
  group_by(StateProvince, Year, Month_name) %>%
  summarise(Call_Count = n()) %>%
  ungroup()

# Set month order for chronological plotting
mh_trend$Month_name <- factor(mh_trend$Month_name, levels = month.abb)

# Plot
ggplot(mh_trend, aes(x = Month_name, y = Call_Count, fill = StateProvince)) +
  geom_col(position = "dodge") +
  facet_wrap(~ Year) +
  labs(title = "Monthly Mental Health Calls by Province (211 Data)",
       x = "Month", y = "Number of Calls") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```


```{r}

# --- 2. Unmet Needs Over the Years ---
unmet_year <- Needs_not_met %>%
  group_by(Year) %>%
  summarise(Unmet_Count = n())

ggplot(unmet_year, aes(x = Year, y = Unmet_Count)) +
  geom_col(fill = "tomato") +
  labs(title = "Unmet Mental Health Needs by Year (211 Data)",
       x = "Year", y = "Number of Unmet Needs") +
  theme_minimal()

```

```{r}

# --- 3. Top Reasons for Unmet Needs (All Years) ---
reason_unmet <- Needs_not_met %>%
  group_by(ReasonUnmet) %>%
  summarise(Count = n()) %>%
  arrange(desc(Count))

ggplot(reason_unmet, aes(x = reorder(ReasonUnmet, Count), y = Count)) +
  geom_col(fill = "orange") +
  coord_flip() +
  labs(title = "Reasons for Unmet Mental Health Needs",
       x = "Reason", y = "Count") +
  theme_minimal()
```





```{r}
# Summarize 211 Call Volume
calls_summary <- Combined_CallReport_mentalhealth %>%
  group_by(StateProvince, Year, Month_name) %>%
  summarise(Call_Count = n(), .groups = "drop")

# Ensure months are ordered
calls_summary$Month_name <- factor(calls_summary$Month_name, levels = month.abb)

# Summarize MHRC Responses
mhrc_summary <- MHRC_dataset %>%
  group_by(PROV, WAVE) %>%
  summarise(Response_Count = n(), .groups = "drop") %>%
  rename(StateProvince = PROV, Month_name = WAVE)

# Merge and replace NAs with 0
comparison_df <- full_join(calls_summary, mhrc_summary, by = c("StateProvince", "Month_name")) %>%
  mutate(
    Call_Count = replace_na(Call_Count, 0),
    Response_Count = replace_na(Response_Count, 0),
    Diff = Call_Count - Response_Count
  )

# Plot Heatmap
ggplot(comparison_df, aes(x = Month_name, y = StateProvince)) +
  geom_tile(aes(fill = Diff), color = "white") +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
  labs(
    title = "Difference Between 211 Calls and MHRC Responses",
    subtitle = "Red = More 211 Calls, Blue = More MHRC Responses",
    fill = "Call - Response"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```




```{r}

Needs_not_met_summarise_reason_Year <- Needs_not_met %>%
  group_by(Year) %>%
  summarise(count = n())

ggplot(Needs_not_met_summarise_reason_Year, aes(x = Year, y = count, group = 1)) +
  geom_line(color = "darkblue", size = 1) +
  geom_point(color = "red") +
  labs(title = "Yearly Trend of Unmet Mental Health Needs",
       x = "Year", y = "Number of Unmet Needs") +
  theme_minimal()
calls_by_prov_year <- Combined_CallReport_mentalhealth %>%
  group_by(StateProvince, Year) %>%
  summarise(count = n())
```


```{r}
ggplot(calls_by_prov_year, aes(x = Year, y = count, fill = StateProvince)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "211 Mental Health Calls by Province and Year",
       x = "Year", y = "Number of Calls") +
  theme_minimal()

```


```{r}
met_status <- Combined_CallReport_mentalhealth %>%
  group_by(NeedMet) %>%
  summarise(count = n())

ggplot(met_status, aes(x = "", y = count, fill = NeedMet)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  labs(title = "Proportion of Met vs Unmet Needs (211 Calls)") +
  theme_void()
```


```{r}

mhrc_grouped <- MHRC_dataset %>%
  group_by(PROV, WAVE) %>%
  summarise(count = n(), .groups = 'drop')

ggplot(mhrc_grouped, aes(x = PROV, y = count, fill = WAVE)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "MHRC Survey Responses by Province and Wave",
       x = "Province", y = "Response Count") +
  theme_minimal(base_size = 10) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 12),  # Tilt labels
    plot.title = element_text(size = 16, face = "bold"),
    legend.title = element_blank()
  )


```






```{r}


# Step 1: Clean & categorize

CallReports_clean <- CallReports %>%
  mutate(
    # Step 1: Create temporary numeric age (or pass "Adult"/"Senior" through)
    temp_age = case_when(
      grepl("(?i)^senior$", Age) ~ NA_real_,
      grepl("(?i)^adult$", Age) ~ NA_real_,
      grepl("^\\d+$", Age) ~ as.numeric(Age),
      grepl("^\\d+-\\d+$", Age) ~ as.numeric(sub("-.*", "", Age)),
      TRUE ~ NA_real_
    ),
    # Step 2: Clean Age Group
    Age_group = case_when(
      grepl("(?i)^senior$", Age) ~ "Senior",
      grepl("(?i)^adult$", Age) ~ "Adult",
      !is.na(temp_age) & temp_age <= 17 ~ "0-17",
      !is.na(temp_age) & temp_age >= 18 & temp_age <= 24 ~ "18-24",
      !is.na(temp_age) & temp_age >= 25 & temp_age <= 34 ~ "25-34",
      !is.na(temp_age) & temp_age >= 35 & temp_age <= 44 ~ "35-44",
      !is.na(temp_age) & temp_age >= 45 & temp_age <= 54 ~ "45-54",
      !is.na(temp_age) & temp_age >= 55 & temp_age <= 64 ~ "55-64",
      !is.na(temp_age) & temp_age >= 65 & temp_age <= 79 ~ "65-79",
      !is.na(temp_age) & temp_age >= 80 ~ "80+",
      TRUE ~ NA_character_
    )
  ) %>%
  filter(!is.na(Age_group)) %>%
  select(-temp_age)  # Clean up temporary column

  
  

CallReports_clean %>%
  count(Age_group) %>%
  ggplot(aes(x = reorder(Age_group, -n), y = n, fill = Age_group)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  scale_fill_viridis_d() +
  labs(
    title = "Call Distribution by Age Group",
    x = "Age Group",
    y = "Number of Calls"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold", hjust = 0.5)
  )



```


```{r}

# Step 1: Convert SCR columns to numeric and pivot to long format
MHRC_long <- MHRC_dataset %>%
  mutate(across(starts_with("SCR"), as.numeric)) %>%
  pivot_longer(cols = starts_with("SCR"), names_to = "Survey", values_to = "Score") %>%
  filter(!is.na(Score))

# Step 2: Calculate change in average score across waves
MHRC_change <- MHRC_long %>%
  group_by(WAVE, Survey) %>%
  summarise(Avg_Score = mean(Score, na.rm = TRUE), .groups = "drop") %>%
  arrange(Survey, WAVE) %>%
  group_by(Survey) %>%
  mutate(ScoreChange = Avg_Score - lag(Avg_Score)) %>%
  filter(!is.na(ScoreChange))

# Step 3: Plot Score Change by Survey across Waves
ggplot(MHRC_change, aes(x = factor(WAVE), y = ScoreChange, group = Survey, color = Survey)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Change in Mental Health Scores Across Waves by Survey",
    x = "Poll Wave",
    y = "Average Score Change"
  ) +
  theme_minimal(base_size = 14) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))



# Step 1: Convert SCR columns to numeric and pivot longer
MHRC_long <- MHRC_dataset %>%
  mutate(across(starts_with("SCR"), as.numeric)) %>%
  pivot_longer(cols = starts_with("SCR"), names_to = "Survey", values_to = "Score") %>%
  filter(!is.na(Score))

# Step 2: Calculate average score per wave and survey
wave_scores <- MHRC_long %>%
  group_by(WAVE, Survey) %>%
  summarise(Avg_Score = mean(Score, na.rm = TRUE), .groups = "drop") %>%
  arrange(Survey, WAVE)

# Step 3: Calculate score changes between waves
wave_scores <- wave_scores %>%
  group_by(Survey) %>%
  mutate(ScoreChange = Avg_Score - lag(Avg_Score)) %>%
  filter(!is.na(ScoreChange)) %>%
  ungroup()

# Step 4: Histogram of Score Changes (All Surveys Combined)
ggplot(wave_scores, aes(x = ScoreChange)) +
  geom_histogram(binwidth = 0.5, fill = "#69b3a2", color = "white") +
  labs(
    title = "Distribution of Average Score Change Across Waves",
    x = "Score Change (Current - Previous)",
    y = "Number of Survey-Wave Pairs"
  ) +
  theme_minimal(base_size = 14)

# Step 5: Boxplot to Show Score Changes by Wave
ggplot(wave_scores, aes(x = factor(WAVE), y = ScoreChange, fill = Survey)) +
  geom_boxplot() +
  labs(
    title = "Score Change Across Waves by Survey Type",
    x = "Poll Wave",
    y = "Change in Average Score"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold", hjust = 0.5)
  )

```

```{r warning=FALSE}

# Load the MHRC dataset
#MHRC_dataset 

# ------------------ 1. Geographic Location (SCR4A) ------------------

location_plot <- MHRC_dataset %>%
  filter(!is.na(SCR4A)) %>%
  count(SCR4A, sort = TRUE) %>%
  ggplot(aes(x = reorder(SCR4A, -n), y = n, fill = SCR4A)) +
  geom_bar(stat = "identity") +
  labs(title = "Geographic Location Distribution", x = "Location Type", y = "Number of Respondents") +
  theme_minimal() +
  theme(legend.position = "none") +
  coord_flip()
print(location_plot)

# ------------------ 2. Employment Sector (SCR8) ------------------

employment_plot <- MHRC_dataset %>%
  filter(!is.na(SCR8)) %>%
  count(SCR8, sort = TRUE) %>%
  ggplot(aes(x = reorder(SCR8, n), y = n, fill = SCR8)) +
  geom_bar(stat = "identity") +
  labs(
    title = "Employment Sector Distribution",
    x = "Employment Sector",
    y = "Number of Respondents"
  ) +
  theme_minimal(base_size = 14) +  # Larger base font
  theme(
    legend.position = "none",
    plot.title = element_text(size = 10, face = "bold"),
    axis.text.y = element_text(size = 6),
    axis.text.x = element_text(size = 8)
  ) +
  coord_flip()

# Print the plot in a bigger window
print(employment_plot)





# ------------------ 3. Household Size (SCR21A) ------------------

household_plot <- MHRC_dataset %>%
  filter(!is.na(SCR21A)) %>%
  mutate(SCR21A = as.numeric(SCR21A)) %>%  # Convert to numeric
  ggplot(aes(x = SCR21A)) +
  geom_histogram(binwidth = 1, fill = "#69b3a2", color = "black") +
  labs(title = "Household Size Distribution", x = "Number of People", y = "Respondents") +
  theme_minimal()

# ------------------ 6. Print or Save Plots ------------------

#print(location_plot)
#print(employment_plot)

print(household_plot)



```

